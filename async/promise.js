'use strict';

//Promise is a JavaScript object for asynchronous operation. 
//í”„ë¡œë¯¸ìŠ¤ëŠ” ë¹„ë™ê¸°ë¥¼ ìˆ˜í–‰í•  ë•Œ ì½œë°±í•¨ìˆ˜ ëŒ€ì‹  ìœ ìš©í•˜ê²Œ ì‚¬ìš©ëœë‹¤
//í”„ë¡œë¯¸ìŠ¤ì˜ 2ê°€ì§€ í¬ì¸íŠ¸
//#############1. state(ìƒíƒœ) 
//í”„ë¡œì„¸ìŠ¤ê°€ ë¬´ê±°ìš´ í—¤ë¹„í•œ ì˜¤í¼ë ˆì´ì…˜ì„ ìˆ˜í–‰í•˜ê³  ìˆëŠ” ì¤‘ì¸ì§€ ì•„ë‹ˆë©´ ìˆ˜í–‰ì´ ê±°ì˜ë‹¤ ì™„ë£Œë˜ì–´ì„œ ì„±ê³µí–ˆëŠ”ì§€ ì‹¤íŒ¨í–ˆëŠ”ì§€
//í”„ë¡œë¯¸ìŠ¤ì˜ ìƒíƒœëŠ” í”„ë¡œë¯¸ìŠ¤ê°€ ë§Œë“¤ì–´ì ¸ì„œ ìš°ë¦¬ê°€ ì§€ì •í•œ ì˜¤í¼ë ˆì´ì…˜ì´ ìˆ˜í–‰ ì¤‘ì¼ë•ŒëŠ” pending ìƒíƒœ
//ì˜¤í¼ë ˆì´ì…˜ì„ ì„±ê³µì ìœ¼ë¡œ ë‹¤ ëë‚´ë©´ fulfilled ìƒíƒœ
//íŒŒì¼ì„ ì°¾ì„ ìˆ˜ê°€ ì—†ê±°ë‚˜ ë„¤íŠ¸ì›Œí¬ì— ë¬¸ì œê°€ ìƒê¸°ë©´ rejectedìƒíƒœê°€ ëœë‹¤

//###############2. í”„ë¡œë“€ìŠ¤ì™€ ì»¨ìŠˆë¨¸ì˜ ì°¨ì´ì ì„ ì•„ëŠ” ê²ƒ
//í”„ë¡œë¯¸ìŠ¤ì—ëŠ” ìš°ë¦¬ê°€ ì›í•˜ëŠ” ë°ì´í„°ë¥¼ í”„ë¡œë“€ì‹±(ì œê³µ) í•˜ëŠ” ì‚¬ëŒê³¼ producer(promise object)ì™€ 
//ì œê³µëœ ë°ì´í„°ë¥¼ ì“°ëŠ” ì‚¬ëŒ, ì†Œë¹„í•˜ëŠ” consumerë¡œ ë‚˜ë‰œë‹¤. ì´ ë‘ ë‹¤ë¥¸ ê²¬í•´ë¥¼ ì´í•´í•˜ëŠ” ê²ƒì´ ì¤‘ìš”

//#######2.1 Producer
//promiseëŠ” í´ë˜ìŠ¤ì´ê¸° ë–„ë¬¸ì— newë¥¼ ì‚¬ìš©í•´ ì˜¤ë¸Œì íŠ¸ë¥¼ ìƒì„±í•œë‹¤
//í”„ë¡œë¯¸ìŠ¤ì˜ ìƒì„±ìì—ëŠ” ì½œë°±í•¨ìˆ˜ë¥¼ ì „ë‹¬í•˜ëŠ”ë° ì´ ì½œë°±í•¨ìˆ˜ëŠ” ê¸°ëŠ¥ì„ ì •ìƒì ìœ¼ë¡œ ìˆ˜í–‰í•´ ë§ˆì§€ë§‰ì— ìµœì¢… ë°ì´í„°ë¥¼ ì „ë‹¬í•˜ëŠ” í•¨ìˆ˜ì™€ ì˜¤ë¥˜ê°€ ë‚ ë•Œ ì‚¬ìš©ë  í•¨ìˆ˜ë¥¼ ë°›ëŠ”ë‹¤

//ìƒˆë¡œìš´ í”„ë¡œë¯¸ìŠ¤ê°€ ë§Œë“¤ì–´ì§ˆ ë•ŒëŠ” ìš°ë¦¬ê°€ ì „ë‹¬í•œ executor í•¨ìˆ˜ê°€ ìë™ì ìœ¼ë¡œ ì‹¤í–‰ëœë‹¤
const promise = new Promise((resolve, reject) => {
    //í”„ë¡œë¯¸ìŠ¤ì•ˆì—ì„œ í—¤ë¹„í•œ ì¼ë“¤ì„ í•œë‹¤ 
    //ë„¤íŠ¸ì›Œí¬ì—ì„œ ë°ì´í„°ë¥¼ ë°›ê±°ë‚˜ íŒŒì¼ì—ì„œ í° ë°ì´í„°ë¥¼ ì½ì–´ì˜¤ëŠ” ê²ƒì„ ë™ê¸°ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ë©´ ê·¸ ë‹¤ìŒë¼ì¸ì˜ ì½”ë“œê°€ ì‹¤í–‰ë˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ë¹„ë™ê¸°ì ìœ¼ë¡œ ì²˜ë¦¬í•œë‹¤
    console.log('doing something...');
    setTimeout(()=>{
        // resolve('ellie')
        reject(new Error('no network'));
    }, 2000);
});

//#######2.2 Consumer : then, catch, finally
//valueë¼ëŠ” ë§¤ê°œë³€ìˆ˜ëŠ” í”„ë¡œë¯¸ìŠ¤ê°€ ì •ìƒì ìœ¼ë¡œ ì˜ ìˆ˜í–‰ì´ ë˜ì–´ì„œ ë§ˆì§€ë§‰ìœ¼ë¡œ ë¦¬ì¡¸ë¸Œ ì½œë°± í•¨ìˆ˜ì—ì„œ ì „ë‹¬ëœ 'ellie'ë¼ëŠ” ê°’ì´ ë“¤ì–´ì˜¨ë‹¤

promise.then((value)=>{
    console.log(value);
})
//ì—ëŸ¬ê°€ ë°œìƒí–ˆì„ ë–„ ì–´ë–»ê²Œ ì²˜ë¦¬í•  ê²ƒì¸ì§€ catchì•ˆì—ì„œ ì½œë°±í•¨ìˆ˜ë¥¼ ë“±ë¡í•´ì£¼ë©´ ëœë‹¤
.catch((error)=>{
    console.log(error);
})
//finally()ì„±ê³µí•˜ë“  ì‹¤íŒ¨í•˜ë“  ìƒê´€ì—†ì´ ë§ˆì§€ë§‰ì— í˜¸ì¶œë˜ì–´ì§€ëŠ” ê²ƒ
.finally(()=>{
    console.log('finally');
})

//############3. Promise chaining
const fetchNumber = new Promise((resolve, reject)=>{
    setTimeout(()=>resolve(123), 1000);
})

//then()ì€ ê°’ì„ ë°”ë¡œ ì „ë‹¬í•  ìˆ˜ë„ ìˆê³  ì•„ë‹ˆë©´ í”„ë¡œë¯¸ìŠ¤ë¥¼ ì „ë‹¬í•´ë„ ëœë‹¤
//ìµœì¢…ì ìœ¼ë¡œ ì¶œë ¥ë˜ëŠ”ë°ê¹Œì§€ ê±¸ë¦¬ëŠ” ì‹œê°„ì€ setTimeoutì— ì„¤ì •í•œ ì‹œê°„ëŒ€ë¡œ ì‹¤í–‰ëœë‹¤.
fetchNumber
.then(num=>num*2)
.then(num=>num*3)
.then(num=>{
    return new Promise((resolve, result)=>{
        setTimeout(()=>resolve(num-1), 1000);
    });
})
.then(num=>console.log(num));

//######4.Error handling
const getHen = () => 
    new Promise((resolve, reject)=>{
        setTimeout(()=>resolve('ğŸ“'), 1000);
    });
const getEgg = hen => 
    new Promise((resolve, reject)=>{
        setTimeout(()=>reject(new Error(`error ${hen} => ğŸ¥š`)), 1000);
    });
const cook = egg => 
    new Promise((resolve, reject)=>{
        setTimeout(()=>resolve(`${egg} => ğŸ³`), 1000);
    });

getHen()
.then(hen => getEgg(hen))
.then(egg => cook(egg))
.then(meal => console.log(meal));

//ìœ„ ì½œë°±í•¨ìˆ˜ë¥¼ ì „ë‹¬í•  ë–„ ë°›ì•„ì˜¤ëŠ” valueë¥¼ ë‹¿ì€ í•¨ìˆ˜ë¡œ ë°”ë¡œ í•˜ë‚˜ë¥¼ í˜¸ì¶œí•˜ëŠ” ê²½ìš°ì—ëŠ” ì•„ë˜ì™€ ê°™ì´ ê°€ëŠ¥í•˜ë‹¤
//ì´ í”„ë¡œë¯¸ìŠ¤ì—ì„œ ë°œìƒí•˜ëŠ” ì—ëŸ¬ë¥¼ ì¡ê³  ì‹¶ì„ë•ŒëŠ” ë°”ë¡œ ë‹¤ìŒì— .catch()ë¥¼ ì‘ì„±í•˜ë©´ ë°”ë¡œ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆë‹¤.
getHen()
.then(getEgg)
.catch(error => {
    return 'ğŸ';
})
.then(cook)
.then(console.log)
.catch(console.log);

//############ 5. 
